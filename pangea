data=${1:6}
unamestr=`uname`
<<<<<<< HEAD
version="2.0"
pwd=`pwd`
dataFolder="$pwd/$version/data"


corpora=$(echo $data | tr "," "\n")


makeRootFolderStructure() {
	#TODO: check if the folders exist before creating them
	mkdir "$pwd/$version"
	mkdir "$pwd/$version/examples"
	mkdir "$pwd/$version/data"
	mkdir "$pwd/$version/tools"
}

makeCorpusFolderStructure() {
	#TODO: check if the folders exist before creating them
	mkdir "$dataFolder/$1"        # create the corpus folder
	mkdir "$dataFolder/$1/src"    
	mkdir "$dataFolder/$1/models"	
}

#$1 corpus name
#$1 extractor name
makeModelFolderStructure() {
	mkdir "$dataFolder/$1/models/$2"
	mkdir "$dataFolder/$1/models/$2/extractor"
	mkdir "$dataFolder/$1/models/$2/mse"
	mkdir "$dataFolder/$1/models/$2/images"
}

downloadCorpusSources(){
	corpusURI='http://scg.unibe.ch/pangea/'$version'/data/'$1'/src/'
=======
arr=$(echo $data | tr ";" "\n")


downloadCorpus(){
	corpusURI=$1
>>>>>>> 329b4dce44c2dcd6bc7e889b5d87cc13c6fd3050
	download=1
	i=1
	while [  $download -eq 1 ]; do
		targetURI=$corpusURI'pt'$i'.tar'
		exists=`curl -s --head $targetURI | head -n 1 | grep "HTTP/1.[01] [23].."`
		if [ -z "$exists" ]; then
			download=0
		else	
			echo "== download $targetURI"
			curl -o "$dataFolder/$1/src/pt$i.tar"  $targetURI
			i=$[i+1]
		fi
	done

<<<<<<< HEAD
downloadExtractor() {
	extractorURI="http://scg.unibe.ch/pangea/$version/data/$1/models/$2/extractor/$2.zip"
	curl -o "$dataFolder/$1/models/$2/extractor/$2.zip" $extractorURI	
}

downloadCorpusModels() {
	corporaURI="http://scg.unibe.ch/pangea/$version/data/$1/models/contents.txt"
	curl -o "$dataFolder/$1/models/contents.txt" $corporaURI
	
	while read model; do
  		echo "== download extractor $model"
		
		makeModelFolderStructure $1 $model
		downloadExtractor $1 $model

	done < "$dataFolder/$1/models/contents.txt"
}

downloadCorpus() {
	makeCorpusFolderStructure $1
	downloadCorpusSources $1
	downloadCorpusModels $1
}

downloadAllCorpora(){
	corporaURI='http://scg.unibe.ch/pangea/'$version'/data/content.txt'
	curl -o "$dataFolder/content.txt" $corporaURI
	
	while read corpus; do
  		echo "== download $corpus"
		downloadCorpus $corpus

	done < "$dataFolder/content.txt"
=======
	echo "== download Models"
	curl -O $corpusURI'MSE.tar'

	echo "== download Metadata"
	curl -O $corpusURI'metadata.tar'
>>>>>>> 329b4dce44c2dcd6bc7e889b5d87cc13c6fd3050
}

unpackCorpus(){
	
	echo "== uncompress"
	for f in $(find . -name 'pt*.tar'); do
		tar xvf $f
	done
	tar xvf 'MSE.tar'
	tar xvf 'metadata.tar'
	
	# -------- unpack qualitas corpus 
	prefix=${1:6:2}
	if [ "$prefix" == 'QC' ]; then
		echo "== install Qualitas Corpus"
		version=${1:9}
		chmod +x 'QualitasCorpus-'$version'/bin/install.pl' 
		'./QualitasCorpus-'$version'/bin/install.pl'
		mv 'QualitasCorpus-'$version 'QC-'$version
	fi	

	# -------- remove downloaded archives
	rm *.tar	
}


<<<<<<< HEAD
case "$1" in

get)
    case "$2" in
        src) 
		if [ $# == 4 ]; 
		then
			if [ "$3" == "-c" ];
			then
				makeRootFolderStructure
				downloadCorpus $4
			else
				echo "wrong arguments"
				exit;
            	fi
		else
			makeRootFolderStructure
			downloadAllCorpora
		fi
    	;;
    	bin)
    	;;
    esac
;;
make)
;;
clean)
;;
edit)
;;
run)
;;
*) echo "Signal number $1 is not processed"
;;
esac

=======
>>>>>>> 329b4dce44c2dcd6bc7e889b5d87cc13c6fd3050
# -------- download

for x in $corpora
do
	corpusURI='http://scg.unibe.ch/pangea/data/'$x'/'
	downloadCorpus $corpusURI
	unpackCorpus $x
done


echo "== download Moose"
curl -O 'http://ci.moosetechnology.org/job/moose-latest-dev/lastSuccessfulBuild/artifact/moose/*zip*/moose.zip'
unzip 'moose.zip'

if [[ "$unamestr" == 'Linux' ]]; then 
	echo "== download Cog for linux"
	curl -OL 'http://pharo.gforge.inria.fr/ci/vm/nbcog/linux/NBCog-linux-latest.zip'
	mv 'NBCog-linux-latest.zip' 'cog.zip'
elif [[ "$unamestr" == 'Darwin' ]]; then
	echo "== download Cog for osx"
	curl -OL 'http://pharo.gforge.inria.fr/ci/vm/nbcog/mac/NBCog-mac-latest.zip'
	mv 'NBCog-mac-latest.zip' 'cog.zip'
fi	
unzip 'cog.zip'

echo "== download analysis template"
curl -OL 'http://scg.unibe.ch/pangea/.analysis_template.st'
mv '.analysis_template.st' 'analysis_template.st'

echo "== download analysis example"
curl -OL 'http://scg.unibe.ch/pangea/.analysis_example.st'
mv '.analysis_example.st' 'analysis_example.st'

echo "== download run script"
curl -OL 'http://scg.unibe.ch/pangea/tools/runAnalysis.sh'
chmod +x "runAnalysis.sh"

rm *.zip

# -------- convert to UTF-8
echo "== convert to UTF8"
for f in $(find . -name '*.java'); do
	iconv -f ISO-8859-1 -t UTF-8 $f>$f".conv" ; mv $f".conv" $f
done
